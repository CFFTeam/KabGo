version: "3"

networks:
  nw-api-auth: 
    driver: bridge
  nw-api-driver: 
    driver: bridge
  nw-api-customer:
    driver: bridge
  nw-api-admin:
    driver: bridge
  nw-api-call-center:
    driver: bridge
  nw-api-call-center-s2:
    driver: bridge
  nw-api-call-center-s3:
    driver: bridge
  nw-api-gps-coordinates:
    driver: bridge
  nw-admin:
    driver: bridge
  nw-call-center:
    driver: bridge
  nw-rabbitmq:
    driver: bridge

services:
  nginx: 
    build: 
      context: ./nginx
    networks:
      - nw-api-auth
      - nw-api-driver
      - nw-api-customer
      - nw-api-admin
      - nw-api-call-center
      - nw-api-call-center-s2
      - nw-api-call-center-s3
      - nw-api-gps-coordinates
      - nw-admin
      - nw-call-center
      - nw-rabbitmq
    hostname: nginx
    container_name: kabgo-nginx-proxy
    ports: 
      - "80:80"
    volumes:
      - ./nginx:/etc/nginx
    depends_on:
      - api-auth
      - api-driver
      - api-customer
      - api-admin
      - api-call-center
      - api-call-center-s2
      - api-call-center-s3
      - gps-coordinates
      - admin
      - call-center
      - rabbitmq

  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: 'kabgo-rabbitmq'
    hostname: 'rabbitmq.kabgo.local'
    networks:
      - nw-rabbitmq
    ports:
        - "5672:5672"
        - "15672:15672"
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  api-auth: 
    build: 
      context: ../KabGo/servers/auth
    networks:
      - nw-api-auth
    hostname: api.auth.kabgo.local
    container_name: kabgo-auth
    ports: 
      - "4100:4100"
    volumes:
      - ../KabGo/servers/auth:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
  
  api-driver: 
    build: 
      context: ../KabGo/servers/driver
    networks:
      - nw-api-driver
    hostname: api.driver.kabgo.local
    container_name: kabgo-driver
    ports: 
      - "4200:4200"
    volumes:
      - ../KabGo/servers/driver:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
    depends_on: 
      - rabbitmq

  api-customer: 
    build: 
      context: ../KabGo/servers/customer
    networks:
      - nw-api-customer
    hostname: api.customer.kabgo.local
    container_name: kabgo-customer
    ports: 
      - "4300:4300"
    volumes:
      - ../KabGo/servers/customer:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
  
  api-admin: 
    build: 
      context: ../KabGo/servers/admin
    networks:
      - nw-api-admin
    hostname: api.admin.kabgo.local
    container_name: kabgo-admin
    ports: 
      - "4400:4400"
    volumes:
      - ../KabGo/servers/admin:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  api-call-center: 
    build: 
      context: ../KabGo/servers/call-center
    networks:
      - nw-api-call-center
    hostname: api.call-center.kabgo.local
    container_name: kabgo-call-center
    ports: 
      - "4500:4500"
    volumes:
      - ../KabGo/servers/call-center:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  api-call-center-s2: 
    build: 
      context: ../KabGo/servers/call-center-s2
    networks:
      - nw-api-call-center-s2
    hostname: api.call-center-s2.kabgo.local
    container_name: kabgo-call-center-s2
    ports: 
      - "4501:4501"
    volumes:
      - ../KabGo/servers/call-center-s2:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  api-call-center-s3: 
    build: 
      context: ../KabGo/servers/call-center-s3
    networks:
      - nw-api-call-center-s3
    hostname: api.call-center-s3.kabgo.local
    container_name: kabgo-call-center-s3
    ports: 
      - "4502:4502"
    volumes:
      - ../KabGo/servers/call-center-s3:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  gps-coordinates: 
    build: 
      context: ../KabGo/servers/gps-coordinates
    networks:
      - nw-api-gps-coordinates
    hostname: api.gps-coordinates.kabgo.local
    container_name: gps-coordinates
    ports: 
      - "4600:4600"
    volumes:
      - ../KabGo/servers/gps-coordinates:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  admin: 
    build: 
      context: ../KabGo/clients/admin
    networks:
      - nw-admin
    hostname: admin.kabgo.local
    container_name: kabgo-admin-client
    ports: 
      - "4410:4410"
    volumes:
      - ../KabGo/clients/admin:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  call-center: 
    build: 
      context: ../KabGo/clients/call-center
    networks:
      - nw-call-center
    hostname: call-center.kabgo.local
    container_name: kabgo-call-center-client
    ports: 
      - "4510:4510"
    volumes:
      - ../KabGo/clients/call-center:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  # zookeeper:
  #   image: 'zookeeper'
  #   restart: always
  #   hostname: zookeeper
  #   container_name: kabgo-zookeeper
  #   ports:
  #     - 2181:2181
  #   environment:
  #     - ALLOW_ANONYMOUS_LOGIN=yes
  #     - FORCE_COLOR=1
  #     - DEBUG_COLORS="true"
  #     - TERM=xterm-256color
  #     - COLORTERM=truecolor

  # kafka:
  #   image: 'bitnami/kafka'
  #   hostname: kafka.kabgo.local
  #   container_name: kabgo-kafka
  #   ports:
  #     - '9092:9092'
  #   environment:
  #     - KAFKA_CFG_BROKER_ID=1
  #     - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181
  #     - KAFKA_CFG_LISTENERS=PLAINTEXT://localhost:9092
  #     - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092
  #     - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT
  #     - ALLOW_PLAINTEXT_LISTENER=yes
  #     - KAFKA_CFG_ALLOW_EVERYONE_IF_NO_ACL_FOUND=true
  #     - FORCE_COLOR=1
  #     - DEBUG_COLORS="true"
  #     - TERM=xterm-256color
  #     - COLORTERM=truecolor
  #   depends_on: 
  #     - zookeeper
